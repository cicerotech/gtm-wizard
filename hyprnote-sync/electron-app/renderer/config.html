<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Configure - Eudia Meeting Sync</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #ffffff;
      min-height: 100vh;
      padding: 24px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .header h1 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .header p {
      color: #8892b0;
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
      color: #ccd6f6;
    }
    
    select, input {
      width: 100%;
      padding: 12px 16px;
      font-size: 15px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #ffffff;
      appearance: none;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: #00d4aa;
    }
    
    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238892b0' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      cursor: pointer;
    }
    
    .status-check {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .check-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .check-icon.success { background: rgba(0, 212, 170, 0.2); color: #00d4aa; }
    .check-icon.error { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
    .check-icon.pending { background: rgba(136, 146, 176, 0.2); color: #8892b0; }
    
    .check-text {
      flex: 1;
    }
    
    .check-label {
      font-weight: 500;
    }
    
    .check-detail {
      font-size: 13px;
      color: #8892b0;
    }
    
    .btn-primary {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      color: #1a1a2e;
      background: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 16px;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 212, 170, 0.3);
    }
    
    .btn-primary:disabled {
      background: #4a4a6a;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-secondary {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      color: #8892b0;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      cursor: pointer;
      margin-top: 12px;
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .success-message {
      text-align: center;
      padding: 40px 20px;
    }
    
    .success-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Step 1: Select User -->
  <div id="step-1">
    <div class="header">
      <h1>üëã Welcome to Eudia Meeting Sync</h1>
      <p>Let's get you set up in under a minute</p>
    </div>
    
    <!-- Hyprnote check -->
    <div class="status-check">
      <div class="check-icon pending" id="hyprnote-icon">‚è≥</div>
      <div class="check-text">
        <div class="check-label">Hyprnote</div>
        <div class="check-detail" id="hyprnote-status">Checking...</div>
      </div>
    </div>
    
    <div class="form-group">
      <label for="user-select">Select your name</label>
      <select id="user-select">
        <option value="">Choose your name...</option>
      </select>
    </div>
    
    <button class="btn-primary" id="save-btn" disabled>
      Save Configuration
    </button>
    
    <button class="btn-secondary" id="help-btn">
      I don't see my name
    </button>
  </div>
  
  <!-- Success screen -->
  <div id="step-success" class="hidden">
    <div class="success-message">
      <div class="success-icon">üéâ</div>
      <h1>You're all set!</h1>
      <p style="color: #8892b0; margin-top: 12px;">
        Your meetings will now sync to Salesforce.
      </p>
      
      <button class="btn-primary" id="done-btn" style="margin-top: 32px;">
        Done
      </button>
    </div>
  </div>
  
  <script>
    const { ipcRenderer } = require('electron');
    
    let teamMembers = [];
    let hyprnoteStatus = null;
    
    async function init() {
      // Load team members
      teamMembers = await ipcRenderer.invoke('get-team-members');
      populateUserSelect();
      
      // Check Hyprnote
      hyprnoteStatus = await ipcRenderer.invoke('check-hyprnote');
      updateHyprnoteStatus();
      
      // Check if already configured
      const config = await ipcRenderer.invoke('get-config');
      if (config && config.rep) {
        document.getElementById('user-select').value = config.rep.email;
        updateSaveButton();
      }
    }
    
    function populateUserSelect() {
      const select = document.getElementById('user-select');
      
      // Filter to active sales team members
      const salesTeam = teamMembers.filter(m => 
        m.team === 'Sales' && !m.deprecated
      ).sort((a, b) => a.name.localeCompare(b.name));
      
      salesTeam.forEach(member => {
        const option = document.createElement('option');
        option.value = member.salesforceUserId;
        option.textContent = member.name;
        option.dataset.email = Object.keys(require('../lib/team-registry').TEAM_MEMBERS)
          .find(email => require('../lib/team-registry').TEAM_MEMBERS[email].salesforceUserId === member.salesforceUserId);
        select.appendChild(option);
      });
    }
    
    function updateHyprnoteStatus() {
      const icon = document.getElementById('hyprnote-icon');
      const status = document.getElementById('hyprnote-status');
      
      if (hyprnoteStatus.success) {
        icon.className = 'check-icon success';
        icon.textContent = '‚úì';
        status.textContent = `Found: ${hyprnoteStatus.sessionCount} recordings`;
      } else {
        icon.className = 'check-icon error';
        icon.textContent = '‚úó';
        status.textContent = 'Not found - please install Hyprnote';
      }
      
      updateSaveButton();
    }
    
    function updateSaveButton() {
      const select = document.getElementById('user-select');
      const saveBtn = document.getElementById('save-btn');
      
      saveBtn.disabled = !select.value || !hyprnoteStatus?.success;
    }
    
    // Event handlers
    document.getElementById('user-select').addEventListener('change', updateSaveButton);
    
    document.getElementById('save-btn').addEventListener('click', async () => {
      const select = document.getElementById('user-select');
      const selectedOption = select.options[select.selectedIndex];
      const userId = select.value;
      
      // Find the team member
      const member = teamMembers.find(m => m.salesforceUserId === userId);
      
      if (!member) {
        alert('Please select your name');
        return;
      }
      
      // Build config
      const config = {
        rep: {
          name: member.name,
          email: selectedOption.dataset.email || `${member.name.toLowerCase().replace(' ', '.')}@eudia.com`,
          salesforceUserId: member.salesforceUserId,
          role: member.role,
          team: member.team
        },
        salesforce: {
          useEnvFile: true,
          syncEnabled: true
        },
        settings: {
          lookbackHours: 168,
          updateCustomerBrain: true,
          createContacts: true,
          syncOwnedAccountsFirst: true
        },
        setupDate: new Date().toISOString()
      };
      
      // Save
      const saved = await ipcRenderer.invoke('save-config', config);
      
      if (saved) {
        document.getElementById('step-1').classList.add('hidden');
        document.getElementById('step-success').classList.remove('hidden');
      } else {
        alert('Failed to save configuration. Please try again.');
      }
    });
    
    document.getElementById('done-btn').addEventListener('click', () => {
      window.close();
    });
    
    document.getElementById('help-btn').addEventListener('click', () => {
      require('electron').shell.openExternal('mailto:keigan.pesenti@eudia.com?subject=Hyprnote%20Sync%20Setup%20Help');
    });
    
    // Initialize
    init();
  </script>
</body>
</html>


