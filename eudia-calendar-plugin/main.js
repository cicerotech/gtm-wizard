var y=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var k=(l,o)=>{for(var e in o)y(l,e,{get:o[e],enumerable:!0})},S=(l,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of b(o))!D.call(l,s)&&s!==e&&y(l,s,{get:()=>o[s],enumerable:!(t=x(o,s))||t.enumerable});return l};var $=l=>S(y({},"__esModule",{value:!0}),l);var c=(l,o,e)=>new Promise((t,s)=>{var i=r=>{try{d(e.next(r))}catch(u){s(u)}},a=r=>{try{d(e.throw(r))}catch(u){s(u)}},d=r=>r.done?t(r.value):Promise.resolve(r.value).then(i,a);d((e=e.apply(l,o)).next())});var N={};k(N,{default:()=>p});module.exports=$(N);var n=require("obsidian");var M={userEmail:"",serverUrl:"https://gtm-wizard.onrender.com",refreshMinutes:5},h="eudia-calendar-view",E=class extends n.ItemView{constructor(e,t){super(e);this.refreshTimer=null;this.plugin=t}getViewType(){return h}getDisplayText(){return"Calendar"}getIcon(){return"calendar"}onOpen(){return c(this,null,function*(){yield this.render();let e=(this.plugin.settings.refreshMinutes||5)*60*1e3;this.refreshTimer=window.setInterval(()=>this.render(),e)})}onClose(){return c(this,null,function*(){this.refreshTimer&&window.clearInterval(this.refreshTimer)})}render(){return c(this,null,function*(){let e=this.containerEl.children[1];e.empty(),e.addClass("eudia-cal-container");let t=e.createDiv({cls:"eudia-cal-header"});t.createEl("h4",{text:"Upcoming Meetings"});let s=t.createEl("button",{cls:"eudia-cal-refresh",text:"\u21BB"});if(s.title="Refresh",s.onclick=()=>this.render(),!this.plugin.settings.userEmail){this.renderEmailSetup(e);return}let i=e.createDiv({cls:"eudia-cal-loading",text:"Loading..."});try{let a=yield this.fetchMeetings();if(i.remove(),!a.success){this.renderError(e,a.error||"Failed to load calendar");return}if(a.totalMeetings===0){e.createDiv({cls:"eudia-cal-empty",text:"No upcoming meetings this week"});return}let d=Object.keys(a.byDay).sort();for(let r of d){let u=a.byDay[r];if(!u||u.length===0)continue;let v=e.createDiv({cls:"eudia-cal-day"});v.createEl("div",{cls:"eudia-cal-day-header",text:this.formatDayName(r)});for(let g of u){let m=v.createDiv({cls:`eudia-cal-meeting ${g.isCustomerMeeting?"customer":""}`});m.createEl("div",{cls:"eudia-cal-time",text:this.formatTime(g.start)});let f=m.createDiv({cls:"eudia-cal-details"});if(f.createEl("div",{cls:"eudia-cal-subject",text:g.subject}),g.accountName)f.createEl("div",{cls:"eudia-cal-account",text:g.accountName});else if(g.attendees.length>0){let T=g.attendees.slice(0,2).map(C=>C.name||C.email.split("@")[0]).join(", ");f.createEl("div",{cls:"eudia-cal-attendees",text:T})}m.title="Click to create note",m.onclick=()=>this.createNoteForMeeting(g)}}}catch(a){i.remove(),this.renderError(e,a.message||"Connection failed")}})}fetchMeetings(){return c(this,null,function*(){let{serverUrl:e,userEmail:t}=this.plugin.settings;return(yield(0,n.requestUrl)({url:`${e}/api/calendar/${t}/week`,method:"GET",headers:{Accept:"application/json"}})).json})}renderEmailSetup(e){let t=e.createDiv({cls:"eudia-cal-setup"});t.createEl("h4",{text:"\u{1F4C5} Connect Your Calendar"}),t.createEl("p",{text:"Enter your work email to see your meetings:"});let s=t.createDiv({cls:"eudia-cal-form"}),i=s.createEl("input",{type:"email",placeholder:"you@company.com"});i.addClass("eudia-cal-input");let a=s.createEl("button",{text:"Connect",cls:"eudia-cal-btn"});a.onclick=()=>c(this,null,function*(){let d=i.value.trim();if(!d||!d.includes("@")){new n.Notice("Please enter a valid email");return}a.textContent="Connecting...",a.setAttribute("disabled","true");try{let r=`${this.plugin.settings.serverUrl}/api/calendar/${d}/today`;(yield(0,n.requestUrl)({url:r,method:"GET"})).json.success!==!1?(this.plugin.settings.userEmail=d,yield this.plugin.saveSettings(),new n.Notice("\u2713 Calendar connected!"),yield this.render()):(new n.Notice("Could not connect. Check your email."),a.textContent="Connect",a.removeAttribute("disabled"))}catch(r){new n.Notice("Connection failed. Try again."),a.textContent="Connect",a.removeAttribute("disabled")}})}renderError(e,t){let s=e.createDiv({cls:"eudia-cal-error"});s.createEl("p",{text:`Error: ${t}`});let i=s.createEl("button",{text:"Retry",cls:"eudia-cal-btn"});i.onclick=()=>this.render()}createNoteForMeeting(e){return c(this,null,function*(){let t=e.start.split("T")[0],s=e.subject.replace(/[<>:"/\\|?*]/g,"_").substring(0,50),i=`${t} - ${s}.md`,a=e.attendees.map(r=>`- ${r.name||r.email}`).join(`
`),d=`---
title: "${e.subject}"
date: ${t}
meeting_time: ${this.formatTime(e.start)}
attendees: ${e.attendees.map(r=>r.name||r.email).join(", ")}
account: ${e.accountName||"TBD"}
sync_to_salesforce: false
---

# ${e.subject}

## Attendees
${a}

## Notes


## Next Steps
- [ ] 
`;try{yield this.app.vault.create(i,d),this.app.vault.getAbstractFileByPath(i)&&(yield this.app.workspace.openLinkText(i,"",!0)),new n.Notice(`Created: ${i}`)}catch(r){new n.Notice("Could not create note")}})}formatDayName(e){let t=new Date(e),s=new Date;s.setHours(0,0,0,0);let i=new Date(t);i.setHours(0,0,0,0);let a=(i.getTime()-s.getTime())/(1e3*60*60*24);return a===0?"Today":a===1?"Tomorrow":t.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}formatTime(e){return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}},w=class extends n.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Eudia Calendar"}),new n.Setting(e).setName("Your Email").setDesc("Your work email (e.g., keigan@eudia.com)").addText(t=>t.setPlaceholder("you@company.com").setValue(this.plugin.settings.userEmail).onChange(s=>c(this,null,function*(){this.plugin.settings.userEmail=s,yield this.plugin.saveSettings()}))),new n.Setting(e).setName("Refresh Interval").setDesc("How often to refresh (minutes)").addSlider(t=>t.setLimits(1,30,1).setValue(this.plugin.settings.refreshMinutes).setDynamicTooltip().onChange(s=>c(this,null,function*(){this.plugin.settings.refreshMinutes=s,yield this.plugin.saveSettings()}))),new n.Setting(e).setName("Test Connection").setDesc("Verify calendar is working").addButton(t=>t.setButtonText("Test").setCta().onClick(()=>c(this,null,function*(){if(!this.plugin.settings.userEmail){new n.Notice("Enter your email first");return}t.setButtonText("Testing...");try{let s=`${this.plugin.settings.serverUrl}/api/calendar/${this.plugin.settings.userEmail}/today`,i=yield(0,n.requestUrl)({url:s,method:"GET"});i.json.success?(new n.Notice(`\u2713 Connected! ${i.json.meetingCount} meetings today`),t.setButtonText("\u2713 Success")):(new n.Notice(`Error: ${i.json.error}`),t.setButtonText("\u2717 Failed"))}catch(s){new n.Notice("Connection failed"),t.setButtonText("\u2717 Failed")}setTimeout(()=>t.setButtonText("Test"),2e3)})))}},p=class extends n.Plugin{onload(){return c(this,null,function*(){console.log("Loading Eudia Calendar"),yield this.loadSettings(),this.registerView(h,e=>new E(e,this)),this.addRibbonIcon("calendar","Eudia Calendar",()=>this.openCalendar()),this.addCommand({id:"open-calendar",name:"Open Calendar",callback:()=>this.openCalendar()}),this.addSettingTab(new w(this.app,this)),this.settings.userEmail&&this.app.workspace.onLayoutReady(()=>{this.openCalendar()})})}loadSettings(){return c(this,null,function*(){this.settings=Object.assign({},M,yield this.loadData())})}saveSettings(){return c(this,null,function*(){yield this.saveData(this.settings)})}openCalendar(){return c(this,null,function*(){let{workspace:e}=this.app,t=e.getLeavesOfType(h)[0];if(!t){let s=e.getRightLeaf(!1);s&&(yield s.setViewState({type:h,active:!0}),t=s)}t&&e.revealLeaf(t)})}onunload(){console.log("Unloading Eudia Calendar")}};
